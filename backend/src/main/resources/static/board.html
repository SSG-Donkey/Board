<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $.get('./common/head.html', function(data) {
        $('head').append(data);
      });
    });
  </script>
</head>


<body>

<!-- header -->
<div id="header"></div>

<section class="home-main-section background-gray">
  <div class="home-hot-content">
    <div class="container">
      <div class="row justify-content-center mb-4">
        <div class="col-auto">
          <div class="btn-group" role="group" aria-label="Category Buttons">
            <a href="/board.html" class="btn btn-outline-primary">전체</a>
            <a href="/board.html?category=1" class="btn btn-outline-primary">도서</a>
            <a href="/board.html?category=2" class="btn btn-outline-primary">의류</a>
            <a href="/board.html?category=3" class="btn btn-outline-primary">전자기기</a>
            <a href="/board.html?category=4" class="btn btn-outline-primary">가구</a>
            <a href="/board.html?category=5" class="btn btn-outline-primary">악세사리</a>
            <a href="/board.html?category=6" class="btn btn-outline-primary">생활용품</a>
            <a href="/board.html?category=9" class="btn btn-outline-primary">기타</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <h1 class="home-main-title home-hot-title">나눔 물품</h1>
  <div id="category"></div>

  <!--  나눔 물품 보여주기-->
  <div class="items-wrap">


  </div>
  <!--페이징-->
  <div class="container">
    <div class="row justify-content-center">
      <div id="pagination" class="col-md-6 text-center"></div>
    </div>
  </div>

</section>
<!-- main section -->
<main>
  <section id="home-main-section-top">
    <div class="home-main-top">
      <div class="home-main-desc">
        <h1 class="home-main-title">
          당신 근처의
          <br>
          당나귀마켓
        </h1>
        <p class="home-text">
          중고 거래부터 동네 정보까지, 이웃과 함께해
          <br>
          가깝고 따뜻한 당신의 근처를 만들어요.
        </p>
      </div>
      <div class="home-main-image">
        <img class="home-main-image" src="./assets/image/prototype_01.png" alt="당신 근처의 당나귀마켓" />
      </div>
    </div>
  </section>
  <section class="home-main-section">
    <div class="home-main-content">
      <div class="home-main-image-01">
        <img class="home-main-image-01" src="./assets/image/prototype_02.png" alt="우리 동네 중고 직거래 사진" />
      </div>
      <div class="home-main-desc">
        <h1 class="home-main-title">
          우리 동네
          <br>
          중고 직거래 마켓
        </h1>
        <p class="home-text">
          동네 주민들과 가깝고 따뜻한 거래를 지금 경험해보세요.
        </p>
        <div class="home-buttons">
          <a class="home-button button-text" href="">인기매물 보기</a>
          <a class="home-button button-text B-1" href="">믿을 수 있는 중고거래</a>
        </div>
      </div>
    </div>
  </section>
  <section class="home-main-section background-pale-green">
    <div class="home-main-content home-main-reverse">
      <div class="home-main-image-02">
        <img class="home-main-image-02" src="./assets/image/prototype_03.png" alt="이웃과 함께 하는 동네생활" />
      </div>
      <div class="home-main-desc">
        <h1 class="home-main-title">
          이웃과 함께 하는
          <br>
          동네생활
        </h1>
        <p class="home-text">
          우리 동네의 다양한 이야기를 이웃과 함께 나누어요.
        </p>
        <ul class="home-story-list">
          <li class="home-story-list-item">
            <div class="icon-story icon-story-01"></div>
            <div class="home-story-title">우리동네질문</div>
            <div class="home-story-text">궁금한 게 있을 땐 이웃에게 물어보세요.</div>
          </li>
          <li class="home-story-list-item">
            <div class="icon-story icon-story-02"></div>
            <div class="home-story-title">동네분실센터</div>
            <div class="home-story-text">무언가를 잃어버렸을 때, 함께 찾을 수 있어요.</div>
          </li>
          <li class="home-story-list-item">
            <div class="icon-story icon-story-03"></div>
            <div class="home-story-title">동네모임</div>
            <div class="home-story-text">관심사가 비슷한 이웃과 온오프라인으로 만나요.</div>
          </li>
        </ul>
      </div>
    </div>
  </section>
  <section class="home-main-section">
    <div class="home-main-content">
      <div class="home-main-image-03">
        <img class="home-main-image-03" src="./assets/image/prototype_04.png" alt="우리 동네 중고 직거래 사진" />
      </div>
      <div class="home-main-desc">
        <h1 class="home-main-title">
          내 근처에서 찾는
          <br>
          동네가게
        </h1>
        <p class="home-text">
          우리 동네 가게를 찾고 있나요?
          <br>
          동네 주민이 남긴 진짜 후기를 함께 확인해보세요!
        </p>
        <div class="home-buttons">
          <a class="home-button button-text" href="">당나귀마켓 동네가게 찾기</a>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- footer -->
<div id="footer"></div>

<script>
  // URL 매개변수 값 가져오기
  const urlParams = new URLSearchParams(window.location.search);
  const category = urlParams.get('category');
  let currentPage = 0;
  const pageSize = 10;
  let totalPages = 0;

  window.onload = function() {
    loadCategoryPosts(category, 0);
  };

  //카테고리 누를 때 페이지 이동
  function loadCategoryPosts(category, page) {
    fetch(`/api_post/category/${category}?page=${page}&size=${pageSize}`)
            .then(response => response.json())
            .then(data => {
              currentPage = data.currentPage;
              totalPages = data.totalPages;
              renderPosts(data.data);
              renderPagination();
            })
            .catch(error => console.error('Error loading posts:', error));
  }
  function renderPosts(posts) {
    const itemsWrap = document.querySelector('.items-wrap');
    itemsWrap.innerHTML = '';
    posts.forEach(post => {
      const itemElement = document.createElement('article');
      itemElement.classList.add('item');
      itemElement.innerHTML = `
                          <a class="item-link" href="/post/${post.postNo}">
                              <div class="item-photo">
                                  <img src="${post.postFile}" alt="${post.postTitle}">
                              </div>
                              <div class="item-desc">
                                  <h2 class="item-name">${post.postTitle}</h2>
                                  <div class="item-postContent">${post.postContent}</div>
                                  <div class="item-regionName">${post.regionName}</div>
                              </div>
                          </a>
                      `;

      itemsWrap.appendChild(itemElement);
    });
  }
  function renderPagination() {
    const paginationDiv = document.getElementById('pagination');
    paginationDiv.innerHTML = '';

    // 이전 버튼 렌더링
    const prevButton = document.createElement('button');
    prevButton.textContent = 'Previous';
    prevButton.disabled = currentPage === 0;
    prevButton.addEventListener('click', () => {
      loadCategoryPosts(category, currentPage - 1);
      scrollToTop(); // 스크롤 맨 위로 이동
    });
    paginationDiv.appendChild(prevButton);

    // 페이지 버튼 렌더링
    const maxPageButtons = 5;
    const startPage = Math.max(0, currentPage - Math.floor(maxPageButtons / 2));
    const endPage = Math.min(totalPages, startPage + maxPageButtons);

    for (let i = startPage; i < endPage; i++) {
      const pageButton = document.createElement('button');
      pageButton.textContent = i + 1;
      if (i === currentPage) {
        pageButton.classList.add('active'); // 활성화된 페이지를 나타내는 클래스 추가
      }
      pageButton.addEventListener('click', () => {
        loadCategoryPosts(category, i);
        scrollToTop(); // 스크롤 맨 위로 이동
      });
      paginationDiv.appendChild(pageButton);
    }

    // 다음 버튼 렌더링
    const nextButton = document.createElement('button');
    nextButton.textContent = 'Next';
    nextButton.disabled = currentPage === totalPages - 1;
    nextButton.addEventListener('click', () => {
      loadCategoryPosts(category, currentPage + 1);
      scrollToTop(); // 스크롤 맨 위로 이동
    });
    paginationDiv.appendChild(nextButton);
  }
  // 스크롤을 맨 위로 이동하는 함수
  function scrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth' // 부드럽게 스크롤
    });
  }

  function setCategoryTitle(category) {
    let title;
    switch(category) {
      case '1':
        title = '도서';
        break;
      case '2':
        title = '의류';
        break;
      case '3':
        title = '전자기기';
        break;
      case '4':
        title = '가구';
        break;
      case '5':
        title = '악세사리';
        break;
      case '6':
        title = '생활용품';
        break;
      case '9':
        title = '기타';
        break;
      default:
        title = '전체';
    }
    $('.home-main-title').text('나눔 물품 - ' + title);
  }

  // 페이지 로드시 실행
  setCategoryTitle(category);
</script>
</body>

</html>